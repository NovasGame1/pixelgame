<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>PixelGame – Games</title>
  <link rel="stylesheet" href="style.css">

  <!-- Three.js + OrbitControls from CDN -->
  <script src="https://cdn.jsdelivr.net/npm/three@0.150.1/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.150.1/examples/js/controls/OrbitControls.js"></script>

  <style>
    body, html { margin:0; padding:0; height:100%; overflow:hidden; }
    #bitsDisplay { position: fixed; top:10px; right:20px; z-index:1000; }
    header, footer { position: absolute; width:100%; z-index:1000; }
    header { top:0; }
    footer { bottom:0; text-align:center; }
    #gameContainer {
      position: absolute;
      top: 60px;    /* height of header */
      bottom: 40px; /* height of footer */
      left: 0;
      right: 0;
    }
  </style>
</head>
<body>
  <div id="bitsDisplay">Bits: <span id="bitCountTop">0</span></div>

  <header>
    <nav>
      <a href="index.html">Home</a>
      <a href="games.html">Games</a>
      <a href="profile.html">Profile</a>
      <a href="people.html">People</a>
      <a href="shop.html">Shop</a>
      <a href="admin.html" id="adminBtn" style="display:none;">Admin</a>
      <a href="login.html" id="loginLink">Login</a>
      <a href="#" id="logoutLink" style="display:none;" onclick="logout()">Logout</a>
    </nav>
  </header>

  <div id="gameContainer"></div>

  <footer>© 2025 PixelGame.</footer>

  <script>
    // Navigation helpers (same as your other pages)
    function logout() {
      localStorage.removeItem('profileUsername');
      localStorage.removeItem('profileBio');
      updateNavLinks();
      window.location.href = 'login.html';
    }
    function updateNavLinks() {
      const u = localStorage.getItem('profileUsername');
      document.getElementById('loginLink').style.display  = u ? 'none' : 'inline';
      document.getElementById('logoutLink').style.display = u ? 'inline' : 'none';
      document.getElementById('adminBtn').style.display  = (u==='Nova') ? 'inline' : 'none';
    }
    function updateBitsDisplay() {
      const ud = JSON.parse(localStorage.getItem('userData'))||{};
      const u  = localStorage.getItem('profileUsername');
      if(ud[u]) document.getElementById('bitCountTop').innerText = ud[u].bits||0;
    }
    document.addEventListener('DOMContentLoaded', ()=>{
      updateNavLinks();
      updateBitsDisplay();
    });

    // Three.js scene setup
    let scene, camera, renderer, controls;
    function initThree() {
      const container = document.getElementById('gameContainer');
      scene   = new THREE.Scene();
      camera  = new THREE.PerspectiveCamera(60, container.clientWidth/container.clientHeight, 0.1, 1000);
      camera.position.set(10, 10, 20);

      renderer = new THREE.WebGLRenderer({ antialias: true });
      renderer.setSize(container.clientWidth, container.clientHeight);
      container.appendChild(renderer.domElement);

      controls = new THREE.OrbitControls(camera, renderer.domElement);
      controls.enableDamping = true;

      // basic lighting
      const ambient = new THREE.AmbientLight(0xffffff, 0.6);
      const dirLight = new THREE.DirectionalLight(0xffffff, 0.6);
      dirLight.position.set(10, 20, 10);
      scene.add(ambient, dirLight);

      window.addEventListener('resize', onResize);
      animate();
    }

    function onResize() {
      const container = document.getElementById('gameContainer');
      camera.aspect = container.clientWidth / container.clientHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(container.clientWidth, container.clientHeight);
    }

    function animate() {
      requestAnimationFrame(animate);
      controls.update();
      renderer.render(scene, camera);
    }

    // Load JSON and build cubes
    function loadGame(jsonPath) {
      fetch(jsonPath)
        .then(res => res.json())
        .then(data => {
          const mat = new THREE.MeshLambertMaterial({ color: 0x8888ff });
          data.blocks.forEach(b => {
            const geo = new THREE.BoxGeometry(b.sx, b.sy, b.sz);
            const mesh = new THREE.Mesh(geo, mat);
            mesh.position.set(b.x, b.y + b.sy/2, b.z);
            scene.add(mesh);
          });
        })
        .catch(err => {
          alert('Failed to load game JSON: ' + err);
        });
    }

    // Entry point
    document.addEventListener('DOMContentLoaded', () => {
      initThree();
      // replace 'NovaTest1.json' with any file name in your 'games' folder:
      loadGame('games/NovaTest1.json');
    });
  </script>
</body>
</html>
